<?include_once 'app/moduli/menu_amm/operazioni/oggetti/OperazioneDefault.php';class accessocivico extends OperazioneDefault {		public function __construct() { }		public function preInsert($arrayParametri = array()) {		global $enteAdmin,$istanzaOggetto;				if($istanzaOggetto['stato_pratica'] == 'caricata' and $_GET['azione_ac'] == 'incarica') {					}			}		public function preUpdate($arrayParametri = array()) {		global $enteAdmin,$entePubblicato;				$istanzaOggetto = mostraDatoOggetto($_GET['id'], 61, '*');		$templateMail = '';		$nomeEvento = '';		if($istanzaOggetto['stato_pratica'] == 'caricata' and $_GET['azione_ac'] == 'incarica') {			//inviare mail a resp trasp, altri utenti, referente			$templateMail = 'mail-'.forzaStringa($_GET['azione_ac']);			$nomeEvento = 'Presa in carico';		} else if($istanzaOggetto['stato_pratica'] == 'in corso' and $_GET['azione_ac'] == 'concludi') {			//inviare mail a resp trasp, altri utenti, referente		    $templateMail = 'mail-'.forzaStringa($_GET['azione_ac']);			$nomeEvento = 'Conclusa';		} else if($istanzaOggetto['stato_pratica'] == 'conclusa' and $_GET['azione_ac'] == 'riesamina') {			//inviare mail a resp trasp, altri utenti, referente		    $templateMail = 'mail-'.forzaStringa($_GET['azione_ac']);			$nomeEvento = 'Richiesto riesame';		}				//se ho impostato il template mail, mando le notifiche		if($templateMail != '') {			$emailNotifiche = array();			if($entePubblicato['utente_responsabile_trasparenza'] > 0) {				$ut = caricaUser($entePubblicato['utente_responsabile_trasparenza']);				if($ut['email'] != '') {					$emailNotifiche[] = $ut['email'];				}			}			$uts = explode(',', $entePubblicato['utenti_notifiche_accessocivico']);			foreach((array)$uts as $u) {				if($u > 0) {					$ut = caricaUser($u);					if($ut['email'] != '') {						$emailNotifiche[] = $ut['email'];					}				}			}			if($_POST['id_gestore'] > 0) {				$gestore = mostraDatoOggetto(forzaNumero($_POST['id_gestore']), 3, '*');				if($gestore['email'] != '') {					$emailNotifiche[] = $gestore['email'];				}			}			if(count($emailNotifiche) > 0) {				include_once('classi/costruisci_mail.php');				$emailNotifiche = implode(';', $emailNotifiche);				$contenutoMail = '';				include('app/template/accessocivico/'.$templateMail.'.php');				$mailAvviso = new costruisciMail('accessocivico', 'Richiesta di Accesso Civico - '.$entePubblicato['nome_completo_ente'].' (cod. '.forzaStringa($_POST['codice_richiesta']).')', $emailNotifiche, $entePubblicato['email_notifiche']);				$mailAvviso->assegnaVariabili(array(						'TESTO' => $contenutoMail				));				$res = $mailAvviso->invia();			}						//creo un evento automatico			$ev = new stdClass();			$ev->data =  '/Date('.(mktime()*1000).')/';			$ev->evento = $nomeEvento;			$ev->dettagli = '';			$ev->evento_automatico = '1';			$ev->id = mktime();
			if($istanzaOggetto['eventi_pratica'] == '') {				$istanzaOggetto['eventi_pratica'] = '[]';			}			$eventi = json_decode($istanzaOggetto['eventi_pratica']);			$eventi[] = $ev;			$_POST['eventi_pratica'] = json_encode($eventi);		}		}		public function postInsert($arrayParametri = array()) {			}		public function postDelete($arrayParametri = array()) {			}	}?>