<?include_once 'app/moduli/menu_amm/operazioni/oggetti/OperazioneDefault.php';class bandiconcorso extends OperazioneDefault {		var $maxId = 0;		public function __construct() { }		public function postInsert($arrayParametri = array()) {		if(moduloAttivo('ealbo')) {			$this->inserisciRecordAtto();		}	}		public function postDelete($arrayParametri = array()) {		if(moduloAttivo('ealbo')) {			$this->eliminaRecordAtto();		}	}		public function preImport($arrayParametri = array()) {		if(!moduloAttivo('concorsi')) {			$this->prendiMaxId();		}	}		public function postImport($arrayParametri = array()) {		if(!moduloAttivo('concorsi')) {			$this->setTipologiaConcorsi();		}	}		private function inserisciRecordAtto() {		global $database, $dati_db, $enteAdmin;				$sql = "SELECT * FROM ".$dati_db['prefisso']."oggetto_concorsi WHERE id_ente = ".$enteAdmin['id']." ORDER BY id DESC LIMIT 1";		if(!($result = $database->connessioneConReturn($sql))) {}		$record = $database->sqlArray($result);				$atto = caricaDocumentoEAlbo('atti', forzaNumero($_POST['id_atto_albo']));				$sql = "INSERT INTO etrasp_atti_ealbo (id_ente, id_ente_albo, id_atto_albo, id_oggetto, id_documento, ultima_modifica) 				VALUES (".$enteAdmin['id'].", ".$enteAdmin['id_ente_albo'].", ".forzaNumero($_POST['id_atto_albo']).", 22, ".$record['id'].", ".$atto['ultima_modifica'].")";		if(!($result = $database->connessioneConReturn($sql))) {}				collegaAttoEtrasparenza(forzaNumero($_POST['id_atto_albo']), 1, $enteAdmin);	}		private function eliminaRecordAtto() {		global $database, $dati_db, $enteAdmin;				$cancello = isset($_POST['id_cancello_tabella']) ? forzaStringa($_POST['id_cancello_tabella']) : 0;		$arrayOggetti = explode(",", $cancello);		$arrayOggettiAlbo = array();		$numeroOggetti = count($arrayOggetti)-1;		$condizione = 'id_documento='.$arrayOggetti[0];		$arrayOggettiAlbo[] = getIdRecordAtto($enteAdmin['id'], $enteAdmin['id_ente_albo'], $arrayOggetti[0], 22);		for ($i=1;$i<$numeroOggetti+1;$i++) {			if ($arrayOggetti[$i] != '') {				$condizione .= ' OR id_documento='.$arrayOggetti[$i];				$arrayOggettiAlbo[] = getIdRecordAtto($enteAdmin['id'], $enteAdmin['id_ente_albo'], $arrayOggetti[$i], 22);			}		}		$sql = "DELETE FROM ".$dati_db['prefisso']."etrasp_atti_ealbo WHERE id_ente = ".$enteAdmin['id']." AND id_ente_albo = ".$enteAdmin['id_ente_albo']." AND id_oggetto = 22 AND (".$condizione.")";		if(!($result = $database->connessioneConReturn($sql))) {}				foreach((array) $arrayOggettiAlbo as $id) {			collegaAttoEtrasparenza($id, 0, $enteAdmin);		}	}		private function prendiMaxId() {		global $database, $dati_db, $enteAdmin;				$sql = "SELECT id FROM ".$dati_db['prefisso']."oggetto_concorsi WHERE id_ente = ".$enteAdmin['id']." ORDER BY id DESC LIMIT 1";		if(!($result = $database->connessioneConReturn($sql))) {}		$record = $database->sqlArray($result);		$this->maxId = ($record['id'] > 0 ? $record['id'] : 0);	}		private function setTipologiaConcorsi() {		global $database, $dati_db, $enteAdmin;				$sql = "UPDATE ".$dati_db['prefisso']."oggetto_concorsi SET tipologia = 'concorsi' WHERE id_ente = ".$enteAdmin['id']." AND id > ".$this->maxId." AND tipologia = '' ";		if(!($result = $database->connessioneConReturn($sql))) {}	}}?>