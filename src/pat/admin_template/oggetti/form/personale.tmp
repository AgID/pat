<script type="text/javascript">	
	
	// attivo la validazione inline del form
	jQuery(document).ready(function(){

		// necessario per i campi file
		jQuery('.uniform-file').uniform();
		// necessario per i campi select con ricerca
		jQuery(".chzn-select").chosen({no_results_text: "Nessun risultato per",allow_single_deselect: true});
		
		// Devo inizializzare il campo editor col nuovo ckEditor
		var editorDesc = CKEDITOR.replace( 'note' );
		var editorDesc = CKEDITOR.replace( 'compensi' );
		var editorDesc = CKEDITOR.replace( 'importi_viaggi' );
		var editorDesc = CKEDITOR.replace( 'altri_incarichi' );
		var editorDesc = CKEDITOR.replace( 'altre_info' );
		var editorDesc = CKEDITOR.replace( 'archivio_informazioni' );
		<? if($enteAdmin['tipo_ente']==5){ ?>
			var editorDesc = CKEDITOR.replace( 'testo_delega' );
		<? } ?>	
		
		function verificheRuolo() {
			// verifico incaricato politico
			if (jQuery("#ruolo").val() == 'Incaricato politico' && jQuery("#ruoloBox").css('display') != 'block') {
				jQuery("#ruoloBox").toggle('fast');
				// inserisco regole validazione sintattica
				jQuery( "#ruolo_politico" ).rules( "add", {
						allegatoCheck: true,
						messages: {
							allegatoCheck: "Devi inserire l'incarico politico assegnato"
						}
				});	
				
			} else if (jQuery("#ruolo").val() != 'Incaricato politico' && jQuery("#ruoloBox").css('display') == 'block') {
				jQuery("#ruolo_politico").val('');
				jQuery("#ruoloBox").toggle('fast');
				jQuery("#ruolo_politico").rules( "remove" );
			}
			
			if (jQuery("#ruolo").val() == 'Dipendente' && jQuery("#fileBox").css('display') == 'block') {
				jQuery("#fileBox").toggle('fast');
				jQuery( "#curriculum" ).rules( "remove" );
				//jQuery( "#retribuzione" ).rules( "remove" );
			} else if (jQuery("#ruolo").val() != 'Dipendente' && jQuery("#fileBox").css('display') != 'block') {
				jQuery("#fileBox").toggle('fast');
				jQuery( "#curriculum" ).rules( "add", {
						allegatoCheck: true,
						messages: {
							allegatoCheck: "Devi inserire un allegato con il curriculum"
						}
				});	
			}
		}
		
		function verificheOrganoPolitico() {
			// verifico organo politico
			var visualizzaDelega = false;
			
			var selectedOptionValue = jQuery('#organo').val();
			if(selectedOptionValue){
				for (var i = 0; i < selectedOptionValue.length; i++) {

					if (selectedOptionValue[i] == 'consiglio comunale'){
							visualizzaDelega=true;			
					}
				}
			}
				
			if(visualizzaDelega){
				jQuery('#delegaBox').show();
			}else {
				jQuery('#delegaBox').hide();
			}			

			
		}
		
		jQuery.validator.addMethod("allegatoCheck", function(value , element) {
			if('<? echo $id; ?>' != '') {
				//modifica
				if(jQuery('#'+element.id+'azione').val() == 'nessuna') {
					return true;
				} else if(jQuery('#'+element.id+'azione').val() == 'elimina') {
					return false;
				} else if(jQuery('#'+element.id+'azione').val() == 'modifica' && !jQuery('#'+element.id).val()) {
					return false;
				} else if(jQuery('#'+element.id+'azione').val() == 'importAllegato' && !jQuery('#import-file-'+element.id).val()) {
					return false;
				} else if(jQuery('#'+element.id+'azione').val() == 'aggiungi' && !jQuery('#'+element.id).val() && !jQuery('#import-file-'+element.id).val()) {
					return false;
				} else {
					return true;
				}
			} else {
				//inserimento
				if(!jQuery('#'+element.id).val() && !jQuery('#import-file-'+element.id).val()) {
					return false;
				} else {
					return true;
				}
			}
		}, 'Inserisci il file allegato');
		
		// necessario per i campi ad aumento con freccia
		jQuery(".input-spinner").spinner({min: 0});	
		
		// Devo inizializzare il controllo sui campi condizionati
		jQuery("#ruolo").change(function(){
		
			//verifiche ruolo
			verificheRuolo();
	
		});
		
		// PROVINCE: controllo se ho selezionato come organo politico Consiglio Provinciale per visualizzare i campi relativi alla delega
		<?if($enteAdmin['tipo_ente']==5){?>
			jQuery("#organo").change(function(){
				//verifiche organo
				verificheOrganoPolitico();
			});
		<?}?>

		
		jQuery("#archivio").change(function(){
			jQuery("#archivioBox").toggle('fast');
				
		});

		jQuery("#formOggetto").validate({
			ignore: null,
			ignore: 'input[type="hidden"]',
			debug: false,
			focusInvalid: true,
			focusCleanup: false,
			errorPlacement: function(error, element) {
				if (element.parent().parent().attr('class') == "input-append") {
					error.appendTo( element.parent().parent().parent().parent() );
				} else {
					error.appendTo( element.parent().parent() );
				}
			},				
			
			rules: {
				<?if(($datiUser['id_ente_admin']==35 OR ($datiUser['id_ente_admin']==142 AND $datiUser['acl']==3)) AND $aclTrasparenza[$menuSecondario]['modifica'] AND $aclTrasparenza[$menuSecondario]['creazione'] AND $_GET['azione'] != 'aggiungi') {
						echo "id_proprietario: \"required\",";
				}?>		

				referente: "required",
				<? // scelta ente
				if ($datiUser['permessi']==10 AND !$id) { 
					echo "id_ente: \"required\",";
				} ?>
				ruolo: "required",
				email: {
					// OSPEDALI RIUNITI ANCONA
					<?if($datiUser['id_ente_admin']!=113){?>
					required: true,
					email: true
					<?}?>
				},
				priorita: "required"
			},
			
			messages: {
				referente: "Inserisci il nome della persona",
				<? // scelta ente
				if ($datiUser['permessi']==10 AND !$id) { 
					echo "id_ente: \"Devi selezionare l'ente associato alla persona\",";
				} ?>
				ruolo: "Devi selezionare il ruolo ricoperto",
				email: "Devi inserire un indirizzo email in un formato valido",
				priorita: "Devi inserire un numero per stabilire l'ordine di visualizzazione",
				id_proprietario: "Devi selezionare l'utente proprietario"
			},
			
			highlight: function(label) {
				jQuery(label).closest('.control-group').addClass('error');
			}

		});
		
		verificheRuolo();
		
		/*
		// aggiungo validatore personalizzato per incarichi politici
		jQuery.validator.addMethod("ruolo_politico", function(value, element) {
			// verifico che il uolo politico sia compilato nel caso 
			if ((value != '' && jQuery("#ruolo").val() == 'Incaricato politico') || jQuery("#ruolo").val() != 'Incaricato politico') {
				return true;
			} else {
				return false;
			}
		}, "Devi inserire il ruolo politico della persona");
		*/		
	});
</script>
<? if(!$box) { ?>
	<a href="?menu=<? echo $menu; ?>&amp;menusec=<? echo $menuSecondario; ?>" class="btn btn-rounded"> <i class="iconfa-circle-arrow-left"></i> &nbsp; Torna a elenco personale</a> 
<? } ?>
<div class="widgetbox box-inverse">

	<h4 class="widgettitle">
		<? if ($id) { echo "Modifica"; } else {  echo "Aggiunta"; } ?> personale
	</h4>

	
	<div class="widgetcontent wc1">
		<? include ('./pat/admin_template/oggetti/info_form.tmp'); ?>
		<form id="formOggetto" class="stdform" method="post" enctype="multipart/form-data" action="?menu=<? echo $menu; ?>&amp;menusec=<? echo $menuSecondario; ?>&amp;azione=lista&amp;azionesec=<? echo $azione; ?>&amp;id=<? echo $id; ?>&amp;box=<? echo $box; ?>">
		
			<? creaFormTrasp('','sistema', '', '', '', '',''); ?>
			
			<? // scelta ente
			if ($datiUser['permessi']==10 AND !$id) { 
				creaFormTrasp('Ente di Appartenenza','enti', 'id_ente', '', '', '','input-xlarge',0,'', 0, 0,true); 
			} else {
				echo "<input type=\"hidden\" id=\"id_ente\" name=\"id_ente\" value=\"".$datiUser['id_ente_admin']."\">";
			} ?>
			
			<? creaFormTrasp('Titolo accademico o professionale','selezione', 'tit', 'arch.,avv.,dott.,dott.ssa,ing.,geom.,prof.,prof.ssa,rag.,sig.,sig.ra,per.', $istanzaOggetto['tit'], '','input-small'); ?>
			
			<? creaFormTrasp('Nome completo<br />(Cognome-Nome)','testo', 'referente', '', $istanzaOggetto['referente'], '','input-xlarge',0,'', 0, 0,true); ?>
			
			<? // la selezione degli organi politici, dipende dal tipo di ente
			if (!isset($tipoEnte['nome_tipo'])) {				
				$organiPoliticiEti = 'commissario,sub commissario,sindaco,vicesindaco,giunta comunale,presidente consiglio comunale,consiglio comunale,direzione generale,segretario generale,commissioni';
				$organiPoliticiVal = 'Commissario prefettizio,Sub Commissario,Sindaco,Vicesindaco,Giunta Comunale,Presidente Consiglio Comunale,Consiglio Comunale,Direzione Generale,Segretario Generale,Commissioni';
			} else {
				// verifico quali sezioni utilizzare per gli organi politici
				$organiPoliticiEti = '';
				$organiPoliticiVal = '';
				if ($tipoEnte['org_sindaco'] != '') {
					$organiPoliticiEti .= 'sindaco';
					$organiPoliticiVal .= $tipoEnte['org_sindaco'];
				}
				if ($tipoEnte['org_vicesindaco'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'vicesindaco';
					$organiPoliticiVal .= $tipoEnte['org_vicesindaco'];
				}
				if ($tipoEnte['org_giunta'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'giunta comunale';
					$organiPoliticiVal .= $tipoEnte['org_giunta'];
				}
				if ($tipoEnte['org_presidente'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'presidente consiglio comunale';
					$organiPoliticiVal .= $tipoEnte['org_presidente'];
				}
				if ($tipoEnte['org_consiglio'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'consiglio comunale';
					$organiPoliticiVal .= $tipoEnte['org_consiglio'];
				}
				if ($tipoEnte['org_direzione'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'direzione generale';
					$organiPoliticiVal .= $tipoEnte['org_direzione'];
				}
				if ($tipoEnte['org_segretario'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'segretario generale';
					$organiPoliticiVal .= $tipoEnte['org_segretario'];
				}
				if ($tipoEnte['org_commissioni'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'commissioni';
					$organiPoliticiVal .= $tipoEnte['org_commissioni'];
				}
				if ($tipoEnte['org_commissario'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'commissario';
					$organiPoliticiVal .= $tipoEnte['org_commissario'];
				}
				if ($tipoEnte['org_sub_commissario'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'sub commissario';
					$organiPoliticiVal .= $tipoEnte['org_sub_commissario'];
				}
				if ($tipoEnte['org_ass_sindaci'] != '') {
					if ($organiPoliticiEti != '') {
						$organiPoliticiEti .= ',';
						$organiPoliticiVal .= ',';						
					}
					$organiPoliticiEti .= 'assemblea dei sindaci';
					$organiPoliticiVal .= $tipoEnte['org_ass_sindaci'];
				}
			}
			/*
			echo "<pre>";
			print_r($tipoEnte);
			echo "</pre>";
			*/
			creaFormTrasp('Organo politico-amministrativo','selezioni', 'organo', $organiPoliticiEti, $istanzaOggetto['organo'], $organiPoliticiVal,'input-xlarge',1); 
			
			?>
			<? if($enteAdmin['tipo_ente']==5){
					echo "<div id=\"delegaBox\" style=\"display:none;\">";
					creaFormTrasp('Delega','casella', 'delega', '1', $istanzaOggetto['delega'], '','');
					creaFormTrasp('Con delega a','html', 'testo_delega', '', $istanzaOggetto['testo_delega'], '','');
					echo "</div>";
			}
			?>

			
			<? creaFormTrasp('Commissioni di appartenenza','testo', 'commissioni', '', $istanzaOggetto['commissioni'], '','input-xlarge'); ?>
			
			<div class="campoMultiplo">
			<? 
			// prelevo eventuali ruoli aggiuntivi
			$valoriRuoli = "Dipendente,P.O.,Funzionario,Dirigente,Incaricato politico,Segretario generale,Commissario";
			if ($enteAdmin['personale_ruoli'] != '') {
						$valoriRuoli .= ",".htmlentities($enteAdmin['personale_ruoli']);
			}
			creaFormTrasp('Ruolo','selezione', 'ruolo', $valoriRuoli, $istanzaOggetto['ruolo'], '','input-xlarge',0,'Seleziona il ruolo', 0, 0,true); ?>
			
			<? // il campo incarico è condizionato al ruolo
			if (!$id OR $istanzaOggetto['ruolo'] != 'Incaricato politico') {
				echo "<div id=\"ruoloBox\" style=\"display:none;\">";
				creaFormTrasp('Incarico di stampo politico','testo', 'ruolo_politico', '', $istanzaOggetto['ruolo_politico'], '','input-xxlarge',0,'Incarico di stampo politico',0, 0,true);
				creaFormTrasp('Atto di nomina o proclamazione','file', 'allegato_nomina', '', $istanzaOggetto['allegato_nomina']);
				echo "</div>";
			} else {				
				creaFormTrasp('Incarico di stampo politico','testo', 'ruolo_politico', '', $istanzaOggetto['ruolo_politico'], '','input-xxlarge',0,'Incarico di stampo politico',0, 0,true);	
				creaFormTrasp('Atto di nomina o proclamazione','file', 'allegato_nomina', '', $istanzaOggetto['allegato_nomina']);				
			}

			
			// verifico se pubblicare i campi file
			if (!$id OR $istanzaOggetto['ruolo'] == 'Dipendente') {
				$stileFile = "none";	
			} else {		
				$stileFile = "block";					
			}
			
			echo "<div id=\"fileBox\" style=\"display:".$stileFile.";\">";
			creaFormTrasp('Curriculum allegato','file', 'curriculum', '', $istanzaOggetto['curriculum'], '','',0,'', 0, 0,true);	
			creaFormTrasp('Atto di conferimento','file', 'atto_conferimento', '', $istanzaOggetto['atto_conferimento']);
			creaFormTrasp('Dati su altre cariche','file', 'altre_cariche', '', $istanzaOggetto['altre_cariche']); 			
			creaFormTrasp('Dati sulla retribuzione','file', 'retribuzione', '', $istanzaOggetto['retribuzione']); 
			creaFormTrasp('Dati sulla retribuzione anni precedenti','file', 'retribuzione1', '', $istanzaOggetto['retribuzione1']); 
			creaFormTrasp('Dati sulla retribuzione anni precedenti','file', 'retribuzione2', '', $istanzaOggetto['retribuzione2']); 
			creaFormTrasp('Dati patrimoniali','file', 'patrimonio', '', $istanzaOggetto['patrimonio']); 
			creaFormTrasp('Dati patrimoniali anni precedenti','file', 'patrimonio1', '', $istanzaOggetto['patrimonio1']); 
			creaFormTrasp('Dati patrimoniali anni precedenti','file', 'patrimonio2', '', $istanzaOggetto['patrimonio2']); 
			
			echo "</div>";
			
			creaFormTrasp('Pubblica in archivio storico','casella', 'archivio', '1', $istanzaOggetto['archivio'], '','');
			
			// verifico se pubblicare i campi archivio
			if (!$id OR !$istanzaOggetto['archivio']) {
				$stileArchivio = "none";	
			} else if ($istanzaOggetto['archivio']) {		
				$stileArchivio = "block";					
			}			
			creaFormTrasp('In carica dal','data', 'carica_inizio', '', $istanzaOggetto['carica_inizio'], '','input-small');
			echo "<div id=\"archivioBox\" style=\"display:".$stileArchivio.";\">";
			
			creaFormTrasp('In carica fino al','data', 'carica_fine', '', $istanzaOggetto['carica_fine'], '','input-small');
			
			echo "</div>";
			
			?>
			</div>
			
			
			<? //creaFormTrasp('Incarico associato','incarico', 'incarico', '', $istanzaOggetto['incarico'], '','input-xxlarge'); ?>
			<? creaFormTrasp('Incarichi associati','incarichimulti', 'incarico', '', $istanzaOggetto['incarico'], '','input-xxlarge'); ?>
			
			<? creaFormTrasp('Contratto a tempo determinato','casella', 'determinato', '1', $istanzaOggetto['determinato'], '',''); ?>
			
			<? creaFormTrasp('Strutture organizzative di appartenenza','strutture', 'uffici', '', $istanzaOggetto['uffici'], '','input-xxlarge'); ?>
						
			<? creaFormTrasp('Foto allegata','file', 'foto', '', $istanzaOggetto['foto'], '',''); ?>
			
			<? creaFormTrasp('Recapito telefonico fisso','testo', 'telefono', '', $istanzaOggetto['telefono'], '',''); ?>
			
			<? creaFormTrasp('Recapito fax','testo', 'fax', '', $istanzaOggetto['fax'], '',''); ?>
			
			<? creaFormTrasp('Recapito telefonico mobile','testo', 'mobile', '', $istanzaOggetto['mobile'], '',''); ?>
			
			<? creaFormTrasp('Indirizzo email','testo', 'email', '', $istanzaOggetto['email'], '','input-xxlarge',0,'', 0, 0,true); ?>
			
			<? creaFormTrasp('Indirizzo email certificata','testo', 'email_cert', '', $istanzaOggetto['email_cert'], '','input-xxlarge'); ?>
			
			<? creaFormTrasp('Note e dichiarazioni Art. 14, c. 1, lett. f), Dlgs n. 33/2013;  Art. 1, c. 1, n. 5, l. n. 441/1982; Art. 47, c. 1, Dlgs n. 33/2013','html', 'note', '', $istanzaOggetto['note'], '',''); ?>
			
			<? creaFormTrasp('Compensi connessi alla carica','html', 'compensi', '', $istanzaOggetto['compensi'], '',''); ?>

			<? creaFormTrasp('Importi di viaggi di servizi e missioni','html', 'importi_viaggi', '', $istanzaOggetto['importi_viaggi'], '',''); ?>

			<? creaFormTrasp('Altri incarichi con oneri a carico della finanza pubblica e relativi compensi','html', 'altri_incarichi', '', $istanzaOggetto['altri_incarichi'], '',''); ?>

			<? creaFormTrasp('Dichiarazione insussistenza cause inconferibilit&agrave;','file', 'dic_inconferibilita', '', $istanzaOggetto['dic_inconferibilita'], '','',0,'', 0, 0,false); ?>
			
			<? creaFormTrasp('Dichiarazione insussistenza cause incompatibilit&agrave;','file', 'dic_incompatibilita', '', $istanzaOggetto['dic_incompatibilita'], '','',0,'', 0, 0,false); ?>

			<? 
			if (!$id) {
				$istanzaOggetto['vis_elenchi'] = 1;
			}
			creaFormTrasp('Utilizza negli elenchi del personale','casella', 'vis_elenchi', '1', $istanzaOggetto['vis_elenchi'], '',''); ?>
			
			<? 
			if (!is_numeric($istanzaOggetto['priorita']) or !$istanzaOggetto['priorita']) {
				$istanzaOggetto['priorita'] = 1;
			}
			creaFormTrasp('Ordine di visualizzazione','testo', 'priorita', '', $istanzaOggetto['priorita'], '','input-small input-spinner',0,'', 0, 0,true); ?>
			
			<? creaFormTrasp('Altre informazioni','html', 'altre_info', '', $istanzaOggetto['altre_info'], '',''); ?>
			
			<? creaFormTrasp('Archivio informazioni','html', 'archivio_informazioni', '', $istanzaOggetto['archivio_informazioni'], '',''); ?>
			
			<? 
			if(moduloAttivo('privacy')){
				creaFormTrasp('Omissis (Privacy)','casella', 'omissis', '1', $istanzaOggetto['omissis'], '','');
			}
			?>

			<p class="stdformbutton">
				<?
				if($statoWfPrecedente['id']) {
					?>
					<button onclick="jQuery('#stato_workflow_da_assegnare').val('<? echo $statoWfPrecedente['id']; ?>');inviaForm=true;" class="btn btn-primary">Torna allo stato precedente (<? echo $statoWfPrecedente['nome']; ?>)</button>
					<?
				}
				?>
				<button onclick="inviaForm=true;" class="btn btn-primary">Salva dati</button>
				<?
				if($statoWfSuccessivo['id']) {
					?>
					<button onclick="jQuery('#stato_workflow_da_assegnare').val('<? echo $statoWfSuccessivo['id']; ?>');inviaForm=true;" class="btn btn-primary">Vai allo stato successivo (<? echo $statoWfSuccessivo['nome']; ?>)</button>
					<?
				}
				?>
			</p>
		</form>
	</div>
</div>