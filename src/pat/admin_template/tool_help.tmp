<? 
///// HELP ONLINE DINAMICO

$sql = "SELECT * FROM ".$dati_db['prefisso']."oggetto_etrasp_help_adminui WHERE menu='".$menu."' AND (menusec='".$menuSecondario."' OR (menusec='nessuna' AND '".$menuSecondario."'='')) LIMIT 0,1";
if ( !($result = $database->connessioneConReturn($sql)) ) {
	die('Errore durante il recupero del help admin ui'.$sql);
}
$helpGui = $database->sqlArray($result);

// ci sono contenuti, verifico le similitiduzioni con le leggi e con help sezioni
if (is_array($helpGui) AND $helpGui['tipo_cont'] != 'nessuna') {

	// creo condizione di estrazione
	$tipoCont = explode(',',$helpGui['tipo_cont']);
	$condizione = '';
	foreach ($tipoCont as $cont) {
		if ($cont != 'contenuto editabile') {
			if ($condizione != '') {
				$condizione = $condizione." OR ";
			}
			$condizione = "(tipo_cont = '".$cont."' OR tipo_cont LIKE '%,".$cont."' OR tipo_cont LIKE '".$cont.",%' OR tipo_cont LIKE '%,".$cont.",%')";
		}
	}
	
	//////////////////////////////////////////////////////////HELP NORMATIVO
	$sql = "SELECT * FROM ".$dati_db['prefisso']."oggetto_etrasp_norma WHERE ".$condizione;
	if ( !($result = $database->connessioneConReturn($sql)) ) {
		die('Errore durante il recupero del help norma'.$sql);
	}
	$helpNorma = $database->sqlArrayAss($result);

	//////////////////////////////////////////////////////////HELP SEZIONI
	$sql = "SELECT * FROM ".$dati_db['prefisso']."oggetto_etrasp_help WHERE ".$condizione;
	if ( !($result = $database->connessioneConReturn($sql)) ) {
		die('Errore durante il recupero del help norma'.$sql);
	}
	$helpSezioni = $database->sqlArrayAss($result);

} 
?>
<script type="text/javascript">	

jQuery(document).ready(function(){	
	jQuery('.tipHelp').popover({html: true,placement:"left",trigger:"hover"});
});

</script>


<li class="odd">
	<a class="dropdown-toggle" data-toggle="dropdown" data-target="#">
	<span class="count"></span>
	<span class="head-icon head-aiuto"></span>
	<span class="headmenu-label">Help Online</span>
	</a>

	<div class="dropdown-menu">
		<div id="helpOnLine" >

		<? if (!is_array($helpGui)) { 
			echo "<i class=\"iconsweets-alert\"></i> La guida di queste funzioni non ï¿½ al momento disponibile.";
		} else { ?>
			<h3><span class="<? echo $funzioneMenu['iconaGrande']; ?>"></span> <? echo $helpGui['titolo']; ?></h3>
			<div style="white-spaces:nowrap !important;">
					<? echo $helpGui['contenuto']; ?>
			</div>
			
			<? if ($helpGui['tipo_contenuti'] != 'nessuna' and count($helpSezioni)) { ?>
			<div style="float:left;width:46%;margin-right:4%;">	
			<h4>Sezioni di pubblicazione</h4>
			
				<? foreach ($helpSezioni as $sezione) { ?>
				<div><i class="iconfa-folder-close"></i> <a data-placement="top" data-rel="tooltip" data-content="<? echo htmlentities($sezione['testo_html']); ?>" data-original-title="<? echo nomeSezDaId($sezione['id_sezione_etrasp'], 'nome'); ?>" class="tipHelp"><? echo nomeSezDaId($sezione['id_sezione_etrasp'], 'nome'); ?></a></div>
				<? } ?>
			</div>		
			<? } ?>
			
			<? if ($helpGui['tipo_contenuti'] != 'nessuna' and count($helpNorma)) { ?>
				<div style="float:left;width:46%;">
				<? if(!moduloAttivo('agid')) { ?>	
					<h4>Riferimenti normativi</h4>
				
					<? foreach ($helpNorma as $norma) { ?>
						<div><i class="iconfa-legal"></i> <a data-placement="top" data-rel="tooltip" data-content="<? echo htmlentities($norma['testo_norma']); ?>" title="<? echo "Articolo ".$norma['num_art']." ".$norma['commi']; ?>" class="tipHelp"><? echo "Articolo ".$norma['num_art']." ".$norma['commi']; ?></a></div>
					<? } ?>
				<? } ?>
				</div>
			<? } ?>
		<? } ?>

			<div style="clear:both;"></div>
			<div style="white-spaces:nowrap !important;">
				<h4>Manualistica</h4>
				
				<div><span class="iconfa-download-alt"></span> <a target="_blank" href="<? echo $server_url; ?>moduli/output_immagine.php?id=807"><? echo $configurazione['denominazione_etrasparenza']; ?> - Manuale Operativo</a></div>
			</div>
		</div>
	</div>
</li>